<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Taller de Autos Concurrente</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='css/styles.css') }}"
    >
</head>
<body>
<div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
        <div class="app-header-main">
            <div class="app-header-icon">ðŸš—</div>
            <div class="app-header-text">
                <h1 class="app-title">Taller de Autos Concurrente</h1>
                <p class="app-subtitle">
                    AsignaciÃ³n de Ã³rdenes con 3 talleres.
                </p>
            </div>
        </div>
    </header>

    <!-- MAIN -->
    <main class="app-main">
        <!-- 1. REGISTRAR ORDEN -->
        <section class="card panel-fijo card-form">
            <div class="card-header">
                <h2>Registrar orden</h2>
                <p class="card-caption">
                    Ã“rdenes registradas:
                    <span class="badge">
                        {{ orders|length }}
                    </span>
                </p>
            </div>

            <!-- Formulario SOLO de datos de la orden -->
            <form
                id="add-order-form"
                class="form-grid"
                action="{{ url_for('add_order_route') }}"
                method="post"
            >
                <!-- Trabajo / orden -->
                <div class="form-field">
                    <label for="description">Trabajo / orden</label>
                    <div class="input-with-dropdown">
                        <input
                            id="description"
                            name="description"
                            type="text"
                            placeholder="Escribe o elige un trabajo tÃ­pico"
                            autocomplete="off"
                            required
                        >

                        <!-- Botoncito tipo desplegable, como prioridad -->
                        <button
                            type="button"
                            class="dropdown-toggle"
                            id="btn-desc-dropdown"
                            aria-label="Mostrar lista de trabajos"
                        >
                            â–¾
                        </button>

                        <ul id="order-suggestions" class="suggestions-list"></ul>
                    </div>

                </div>

                <!-- Tiempo de Orden -->
                <div class="form-field inline">
                    <label for="prep_time">Tiempo de Orden</label>
                    <input
                        type="number"
                        id="prep_time"
                        name="prep_time"
                        min="1"
                        placeholder="Tiempo en minutos"
                        value=""
                        autocomplete="off"
                        required
                    />
                </div>

                <!-- Prioridad -->
                <div class="form-field inline">
                    <label for="priority">Prioridad</label>
                    <select id="priority" name="priority" autocomplete="off" required>
                        <option value="" selected disabled>Selecciona prioridad</option>
                        <option value="1">1 - Baja</option>
                        <option value="2">2 - Media</option>
                        <option value="3">3 - Alta</option>
                    </select>
                </div>
            </form>

            <!-- Misma lÃ­nea: Agregar (envÃ­a add-order-form) y Procesar -->
            <div class="form-actions-row">
                <!-- Agregar orden: usa el form de arriba por ID -->
                <button
                    type="submit"
                    class="btn primary"
                    form="add-order-form"
                >
                    Agregar orden
                </button>

                <!-- Procesar Ã³rdenes: form independiente, NO exige campos -->
                <form action="{{ url_for('process_orders_route') }}" method="post">
                    <button type="submit" class="btn success">
                        Procesar Ã³rdenes
                    </button>
                </form>
            </div>
        </section>

        <!-- 2. Ã“RDENES REGISTRADAS -->
        <section class="card panel-fijo card-orders">
            <div class="card-header">
                <h2>Ã“rdenes registradas</h2>
            </div>

            {% if orders %}
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>DescripciÃ³n</th>
                            <th>Tiempo</th>
                            <th>Prioridad</th>
                            <th>Estado</th>
                            <th>Taller</th>
                        </tr>
                        </thead>
                        <tbody id="orders-tbody">
                        {% for o in orders %}
                            <tr class="status-{{ 'completada' if o.status == 'Completada' else 'pendiente' }}">
                                <td>{{ o.id }}</td>
                                <td>{{ o.description }}</td>
                                <td>{{ o.prep_time }}</td>
                                <td>{{ o.priority }}</td>
                                <td>{{ o.status }}</td>
                                <td>{{ o.worker_id if o.worker_id else "-" }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- BotÃ³n Actualizar solo cuando hay Ã³rdenes -->
                <div class="orders-refresh">
                    <button type="button" class="btn primary" id="btn-refresh">
                        Actualizar
                    </button>
                </div>
            {% else %}
                <p class="empty-text">
                    AÃºn no has registrado Ã³rdenes.
                </p>
            {% endif %}
        </section>

        <!-- 3. SECUENCIA DE EVENTOS + REINICIAR ARRIBA DEL BOX -->
        <div class="logs-wrapper panel-fijo">
            <!-- BotÃ³n Reiniciar encima del box (mismo estilo) -->
            <form action="{{ url_for('reset_route') }}" method="post">
                <button type="submit" class="btn primary reset-btn">
                    Reiniciar
                </button>
            </form>

            <section class="card card-logs">
                <div class="card-header">
                    <h2>Secuencia de eventos</h2>
                </div>

                {% if logs %}
                    <div id="logs-box" class="logs-box">
                        {% for line in logs %}
                            <div>{{ line }}</div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="empty-text">
                        AÃºn no hay logs. Registra Ã³rdenes y luego procesa.
                    </p>
                {% endif %}
            </section>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="app-footer">
        Proyecto Final sobre concurrencia utilizando Python, hilos y Flask.<br>
        Asignatura: Sistemas Distribuidos<br>
        Docente: Brayan Andru Montenegro.<br>
        UNICUCES 2025
    </footer>
</div>

<!-- JSON con las tareas sugeridas para el JS -->
<script id="tasks-data" type="application/json">
    {{ tasks|tojson }}
</script>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
