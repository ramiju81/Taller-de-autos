<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Taller de Autos Concurrente</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
        rel="stylesheet"
        href="{{ url_for('static', filename='css/styles.css') }}"
    >
</head>
<body>
<div class="app-shell">
    <!-- HEADER -->
    <header class="app-header">
        <div class="app-header-main">
            <div class="app-header-icon"></div>
            <div class="app-header-text">
                <h1 class="app-title">Taller de Autos Concurrente</h1>
                <p class="app-subtitle">
                    Asignaci贸n de 贸rdenes con 3 talleres.
                </p>
            </div>
        </div>
    </header>

    <!-- MAIN -->
    <main class="app-main">
        <!-- 1. REGISTRAR ORDEN -->
        <section class="card panel-fijo card-form">
            <div class="card-header">
                <h2>Registrar orden</h2>
                <p class="card-caption">
                    rdenes registradas:
                    <span class="badge">
                        {{ orders|length }}
                    </span>
                </p>
            </div>

            <!-- UN SOLO FORM: Agregar y Procesar comparten campos -->
            <form id="order-form" class="form-grid" method="post">
                <!-- Trabajo / orden (SELECT) -->
                <div class="form-field">
                    <label for="description">Trabajo / orden</label>
                    <select id="description" name="description" required>
                        <option value="" selected disabled>Selecciona un trabajo t铆pico</option>
                        {% for t in tasks %}
                            <option value="{{ t.name }}">{{ t.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Tiempo de Orden -->
                <div class="form-field inline">
                    <label for="prep_time">Tiempo de Orden</label>
                    <input
                        type="number"
                        id="prep_time"
                        name="prep_time"
                        min="1"
                        placeholder="Tiempo en minutos"
                        autocomplete="off"
                        required
                    />
                </div>

                <!-- Prioridad -->
                <div class="form-field inline">
                    <label for="priority">Prioridad</label>
                    <select id="priority" name="priority" required>
                        <option value="" selected disabled>Selecciona prioridad</option>
                        <option value="1">1 - Baja</option>
                        <option value="2">2 - Media</option>
                        <option value="3">3 - Alta</option>
                    </select>
                </div>

                <!-- Botones Agregar / Procesar en la misma fila -->
                <div class="form-actions-row">
                    <!-- ESTE CREA LA ORDEN (usa campos + required) -->
                    <button
                        type="submit"
                        class="btn primary"
                        formaction="{{ url_for('add_order_route') }}"
                    >
                        Agregar orden
                    </button>

                    <!-- ESTE SOLO PROCESA LO QUE YA EST EN LISTA (NO CREA ORDEN) -->
                    <button
                        type="submit"
                        class="btn success"
                        formaction="{{ url_for('process_orders_route') }}"
                        formnovalidate
                    >
                        Procesar 贸rdenes
                    </button>
                </div>
            </form>
        </section>

        <!-- 2. RDENES REGISTRADAS -->
        <section class="card panel-fijo card-orders">
            <div class="card-header">
                <h2>rdenes registradas</h2>
            </div>

            {% if orders %}
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Descripci贸n</th>
                            <th>Tiempo</th>
                            <th>Prioridad</th>
                            <th>Estado</th>
                            <th>Taller</th>
                        </tr>
                        </thead>
                        <tbody id="orders-tbody">
                        {% for o in orders %}
                            <tr class="status-{{ 'completada' if o.status == 'Completada' else 'pendiente' }}">
                                <td>{{ o.id }}</td>
                                <td>{{ o.description }}</td>
                                <td>{{ o.prep_time }}</td>
                                <td>{{ o.priority }}</td>
                                <td>{{ o.status }}</td>
                                <td>{{ o.worker_id if o.worker_id else "-" }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="empty-text">
                    A煤n no has registrado 贸rdenes.
                </p>
            {% endif %}

            <!-- Bot贸n Actualizar solo si hubo procesamiento (hay logs) -->
            {% if logs %}
            <div class="orders-refresh">
                <button type="button" class="btn primary" id="btn-refresh">
                    Actualizar
                </button>
            </div>
            {% endif %}
        </section>

        <!-- 3. SECUENCIA DE EVENTOS + BOTN REINICIAR ARRIBA -->
        <div class="logs-wrapper panel-fijo">
            <!-- Bot贸n Reiniciar flotando ENCIMA del box, mismo estilo -->
            <form class="reset-form" action="{{ url_for('reset_route') }}" method="post">
                <button type="submit" class="btn primary reset-btn">
                    Reiniciar
                </button>
            </form>

            <section class="card card-logs">
                <div class="card-header">
                    <h2>Secuencia de eventos</h2>
                </div>

                {% if logs %}
                    <div id="logs-box" class="logs-box">
                        {% for line in logs %}
                            <div>{{ line }}</div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="empty-text">
                        A煤n no hay logs. Registra 贸rdenes y luego procesa.
                    </p>
                {% endif %}
            </section>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="app-footer">
        Proyecto Final sobre concurrencia utilizando Python, hilos y Flask.<br>
        Asignatura: Sistemas Distribuidos<br>
        Docente: Brayan Andru Montenegro.<br>
        UNICUCES 2025
    </footer>
</div>

<!-- JSON con las tareas sugeridas (se usa en el JS para tiempo/prioridad) -->
<script id="tasks-data" type="application/json">
    {{ tasks|tojson }}
</script>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
