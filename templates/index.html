<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Taller de Autos ‚Äì Simulaci√≥n con 3 hilos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, #0f172a, #020617 60%),
        radial-gradient(circle at bottom right, #022c22, #020617 60%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      color: #e5e7eb;
    }

    .app {
      width: 100%;
      max-width: 1100px;
      background: rgba(15, 23, 42, 0.98);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 18px 18px 14px;
      box-shadow:
        0 20px 45px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.7);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .title-block h1 {
      font-size: 1.3rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      padding: 3px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .title-block p {
      margin-top: 2px;
      font-size: 0.8rem;
      color: #9ca3af;
    }

    .kpi {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 0.8rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.15);
      border: 1px solid rgba(45, 212, 191, 0.6);
      color: #a5f3fc;
    }

    .pill span.count {
      font-weight: 700;
      font-size: 0.9rem;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.6fr);
      gap: 16px;
    }

    .panel {
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129, 140, 248, 0.15), transparent 55%);
      border-radius: 14px;
      padding: 16px 14px 14px;
      border: 1px solid rgba(55, 65, 81, 0.9);
    }

    .panel-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .panel-title .icon {
      font-size: 1rem;
    }

    .panel-subtitle {
      font-size: 0.76rem;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .field-group {
      margin-bottom: 10px;
    }

    label {
      display: block;
      font-size: 0.8rem;
      color: #e5e7eb;
      margin-bottom: 4px;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: rgba(15, 23, 42, 0.97);
      color: #f9fafb;
      font-size: 0.88rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: #60a5fa;
      box-shadow: 0 0 0 1px rgba(96, 165, 250, 0.7);
    }

    .row-inline {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .row-inline span {
      font-size: 0.78rem;
      color: #cbd5f5;
    }

    .hint {
      font-size: 0.72rem;
      color: #9ca3af;
      margin-top: 3px;
    }

    button {
      margin-top: 6px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #6366f1, #22c55e);
      color: #f9fafb;
      font-weight: 600;
      border: none;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 12px 28px rgba(79, 70, 229, 0.55);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 34px rgba(79, 70, 229, 0.6);
      filter: brightness(1.04);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.5);
      filter: brightness(0.97);
    }

    button[disabled] {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    button span.icon {
      font-size: 1rem;
    }

    .orders-table-wrapper {
      margin-top: 10px;
      border-radius: 10px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      overflow: hidden;
      background: rgba(15, 23, 42, 0.96);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
    }

    th,
    td {
      padding: 5px 7px;
      text-align: left;
    }

    th {
      background: rgba(15, 23, 42, 0.98);
      border-bottom: 1px solid rgba(55, 65, 81, 0.95);
      font-weight: 600;
      color: #e5e7eb;
    }

    tr:nth-child(even) td {
      background: rgba(15, 23, 42, 0.9);
    }

    tr:nth-child(odd) td {
      background: rgba(15, 23, 42, 0.96);
    }

    .priority-low { color: #a5b4fc; }
    .priority-medium { color: #facc15; }
    .priority-high { color: #fb923c; font-weight: 600; }

    .status-pending { color: #e5e7eb; }
    .status-processing { color: #38bdf8; }
    .status-done { color: #4ade80; font-weight: 600; }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
      font-size: 0.76rem;
      color: #9ca3af;
    }

    .logs {
      height: 260px;
      overflow-y: auto;
      padding: 8px 8px 4px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.97);
      border: 1px solid rgba(55, 65, 81, 0.95);
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
      line-height: 1.4;
      color: #9ca3af;
    }

    .log-line { margin-bottom: 3px; }

    .log-empty { color: #6b7280; }

    .footer {
      margin-top: 12px;
      font-size: 0.72rem;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .footer a {
      color: #93c5fd;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.74rem;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
      .logs { height: 220px; }
      .header { flex-direction: column; align-items: flex-start; }
      .kpi { align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title-block">
        <h1>
          <span>üöó Taller de Autos Concurrente</span>
          <span class="badge">3 talleres ¬∑ 3 hilos</span>
        </h1>
        <p>
          Ingresa las √≥rdenes con su tiempo y prioridad. Al procesarlas,
          los tres talleres trabajan en paralelo y el log resume la ejecuci√≥n.
        </p>
      </div>
      <div class="kpi">
        <div class="pill">
          <span>√ìrdenes registradas:</span>
          <span class="count">{{ orders|length }}</span>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- Panel izquierdo -->
      <div class="panel">
        <div class="panel-title">
          <span class="icon">üìù</span>
          Registrar orden
        </div>
        <div class="panel-subtitle">
          Escribe la orden del taller, el tiempo y la prioridad.
        </div>

        <form method="POST" action="{{ url_for('add_order') }}">
          <div class="field-group">
            <label for="description">Descripci√≥n de la orden</label>
            <input
              type="text"
              id="description"
              name="description"
              placeholder="Ej: Cambio de aceite, Alineaci√≥n, Revisi√≥n de frenos..."
              required
            />
          </div>

          <div class="field-group">
            <label for="prep_time">Tiempo estimado</label>
            <div class="row-inline">
              <input
                type="number"
                id="prep_time"
                name="prep_time"
                min="1"
                step="1"
                value="3"
                required
              />
              <span>minutos l√≥gicos (simulados r√°pidamente).</span>
            </div>
          </div>

          <div class="field-group">
            <label for="priority">Prioridad</label>
            <select id="priority" name="priority" required>
              <option value="1">1 - Baja</option>
              <option value="2" selected>2 - Media</option>
              <option value="3">3 - Alta</option>
            </select>
          </div>

          <button type="submit">
            <span class="icon">‚ûï</span>
            Agregar a la cola
          </button>
        </form>

        <hr style="border:none;border-top:1px solid rgba(55,65,81,0.9);margin:12px 0;" />

        <div class="panel-title">
          <span class="icon">üìã</span>
          √ìrdenes registradas (orden de llegada)
        </div>

        {% if orders %}
          <div class="orders-table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Descripci√≥n</th>
                  <th>Tiempo</th>
                  <th>Prioridad</th>
                  <th>Estado</th>
                  <th>Taller</th>
                </tr>
              </thead>
              <tbody>
                {% for o in orders %}
                  <tr>
                    <td>{{ o.id }}</td>
                    <td>{{ o.description }}</td>
                    <td>{{ o.prep_time }} min</td>
                    <td>
                      {% if o.priority == 1 %}
                        <span class="priority-low">Baja</span>
                      {% elif o.priority == 2 %}
                        <span class="priority-medium">Media</span>
                      {% else %}
                        <span class="priority-high">Alta</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if o.status == 'Pendiente' %}
                        <span class="status-pending">Pendiente</span>
                      {% elif o.status == 'En proceso' %}
                        <span class="status-processing">En proceso</span>
                      {% else %}
                        <span class="status-done">Completada</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if o.worker_id %}
                        Taller {{ o.worker_id }}
                      {% else %}
                        -
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="hint" style="margin-top:4px;">
            A√∫n no se ha ingresado ninguna orden.
          </div>
        {% endif %}

        <div class="toolbar">
          <span>
            Ingresa todas las √≥rdenes que quieras y luego l√°nzalas con los 3 talleres.
          </span>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <form method="POST" action="{{ url_for('process_orders') }}">
              <button type="submit" {% if not orders %}disabled{% endif %}>
                <span class="icon">‚ñ∂</span>
                Procesar √≥rdenes (3 hilos)
              </button>
            </form>
            <form method="POST" action="{{ url_for('reset') }}">
              <button type="submit">
                Limpiar todo
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Panel derecho: log de texto -->
      <div class="panel">
        <div class="panel-title">
          <span class="icon">üì°</span>
          Log de ejecuci√≥n
        </div>
        <div class="panel-subtitle">
          Muestra qu√© taller toma cada orden y cu√°ndo la finaliza.
        </div>

        <div class="logs" id="logs-box">
          {% if logs %}
            {% for line in logs %}
              <div class="log-line">{{ line }}</div>
            {% endfor %}
          {% else %}
            <div class="log-line log-empty">
              A√∫n no hay ejecuci√≥n. Registra √≥rdenes y pulsa <strong>Procesar √≥rdenes</strong>.
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="footer">
      <div>
        Programaci√≥n concurrente con Python + threads aplicada a un taller de autos.
      </div>
      <div>
        <a href="#" onclick="location.reload(); return false;">Refrescar vista</a>
      </div>
    </div>
  </div>

  <script>
    const logsBox = document.getElementById("logs-box");
    if (logsBox) {
      logsBox.scrollTop = logsBox.scrollHeight;
    }
  </script>
</body>
</html>
